<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Conv√™nio Biovetfarma</title>

  <!-- Manifest e √≠cones (caminhos relativos) -->
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./assets/icons/icon-192.png">
  <link rel="apple-touch-icon" href="./assets/icons/icon-192.png">
  <meta name="theme-color" content="#2bb380">

  <!-- Estilos -->
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="app-shell">
    <div class="header">
      <img src="./assets/logo.png" alt="Biovetfarma logo" />
      <h1>Conv√™nio Biovetfarma</h1>
      <div style="margin-left:auto" id="userBadge" class="small"></div>
    </div>

    <!-- LOGIN -->
    <div id="view-login" class="card">
      <h2>Entrar</h2>
      <div class="row">
        <div class="col">
          <div class="input">
            <label for="email">Email</label>
            <input id="email" type="email" placeholder="voce@empresa.com" autocomplete="username" required>
          </div>
          <div class="input">
            <label for="password">Senha</label>
            <input id="password" type="password" placeholder="********" autocomplete="current-password" required>
          </div>
          <button class="btn" id="btnLogin">Entrar</button>
          <div style="margin-top:10px">
            <a href="#" id="linkReset">Esqueci minha senha</a> ¬∑
            <a href="#" id="linkSignup">Criar conta</a>
          </div>
          <div id="loginMsg" class="small" style="margin-top:8px"></div>
        </div>
      </div>
    </div>

    <!-- SIGNUP -->
    <div id="view-signup" class="card hidden">
      <h2>Criar conta</h2>
      <div class="row">
        <div class="col">
          <div class="input"><label for="signupName">Nome completo</label><input id="signupName" type="text" placeholder="Seu nome" autocomplete="name"></div>
          <div class="input"><label for="signupEmail">Email</label><input id="signupEmail" type="email" placeholder="voce@empresa.com" autocomplete="email"></div>
          <div class="input"><label for="signupPassword">Senha</label><input id="signupPassword" type="password" placeholder="********" autocomplete="new-password"></div>
          <button class="btn" id="btnSignup">Criar</button>
          <button class="btn secondary" id="btnBackToLogin" style="margin-left:10px">Voltar</button>
          <div class="small" style="margin-top:8px">Observa√ß√£o: o administrador precisa vincular seu email √† aba do funcion√°rio na planilha para liberar o acesso.</div>
          <div id="signupMsg" class="small" style="margin-top:8px"></div>
        </div>
      </div>
    </div>

    <!-- APP -->
    <div id="view-app" class="hidden">
      <div class="layout">
        <div class="nav">
          <a href="#" class="link active" data-nav="home">Home</a>
          <a href="#" class="link" data-nav="compras">Compras</a>
          <a href="#" class="link" data-nav="historico">Hist√≥rico</a>
          <a href="#" class="link hidden" data-nav="admin">Dashboard (Admin)</a>
          <a href="#" class="link" id="linkLogout">Sair</a>
        </div>

        <div class="col">
          <!-- HOME -->
          <div id="page-home" class="card">
            <h2>Ol√°, <span id="homeName">...</span> üëã</h2>
            <p class="small">Aqui voc√™ v√™ seus dados cadastrais e navega entre Compras e Hist√≥rico.</p>
            <div class="row" style="margin-top:12px">
              <div class="col">
                <div class="card">
                  <b>Seus dados</b>
                  <div id="profileBox" class="small" style="margin-top:8px"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- COMPRAS -->
          <div id="page-compras" class="card hidden">
            <h2>Solicitar compra</h2>
            <div class="input">
              <label for="orcamento">N√∫mero do or√ßamento</label>
              <input id="orcamento" type="text" placeholder="Ex.: 250900030" inputmode="numeric">
            </div>
            <button class="btn" id="btnSubmitCompra">Submeter para aprova√ß√£o</button>
            <div id="comprasMsg" class="small" style="margin-top:8px"></div>
          </div>

          <!-- HIST√ìRICO -->
          <div id="page-historico" class="card hidden">
            <h2>Hist√≥rico de autoriza√ß√µes</h2>
            <div class="notice">Pedidos autorizados para desconto em folha:</div>
            <table class="table" id="histTable">
              <thead><tr><th>Data</th><th>Or√ßamento</th><th>Valor</th><th>Autoriza√ß√£o</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>

          <!-- ADMIN -->
          <div id="page-admin" class="card hidden">
            <h2>Dashboard (Admin)</h2>
            <div class="row" style="align-items:center">
              <div class="col"><b id="adminEmployeeName">Funcion√°rio</b></div>
              <div class="col" style="text-align:right">
                <button class="btn secondary" id="btnPrevEmp">‚óÄ Anterior</button>
                <button class="btn" id="btnNextEmp">Pr√≥ximo ‚ñ∂</button>
              </div>
            </div>
            <table class="table" id="adminHistTable" style="margin-top:12px">
              <thead><tr><th>Data</th><th>Or√ßamento</th><th>Valor</th><th>Autoriza√ß√£o</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="footer">¬© Conv√™nio Biovetfarma</div>
    </div>
  </div>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js" defer></script>

  <!-- Seus arquivos -->
  <script src="./firebase-config.js" defer></script>
  <script src="./api.js" defer></script>
  <script src="./app.js" defer></script>

  <!-- Service Worker: registro RELATIVO para GitHub Pages em subpasta -->
  <script defer>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(err => {
          console.error('SW registration failed:', err);
        });
      });
    }
  </script>
</body>
</html>
